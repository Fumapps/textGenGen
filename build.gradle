ext.languageName = "TextGenGen"
ext.mpsVersion = "2021.2.4"
ext.mpsPlugins = [ "de.slisson.mps.editor.multiline" : 13253,
                   "de.itemis.mps.extensions.build": 17136 ]

apply from: 'gradle/init-gradle-scripts.gradle'

task prepareMps {
    group 'mps'
    dependsOn buildOsSpecificBundle
}

// due to MPS-33503 The "generate" task cannot handle java source stub models correctly (a minimalistic test case included)
// we have to compile the java sources and include class files in MPS, to make our build from CLI work
task assembleEditorToTextJar(type: Exec) {
    def javaFiles = fileTree("$projectDir/java_src/EditorToText_IDEA").matching {
        include "**/*.java"
    }.collect { it.toString() }
    commandLine "$javaHome/bin/javac", "-d", "$buildDir/java_src"
    args javaFiles
    doLast {
        ant.jar(destfile: "$projectDir/java_src/lib/editorToText.jar", basedir: "$buildDir/java_src")
    }
}

task mpsBuild {
    group 'mps'
    dependsOn 'mpsAntGenerate', 'mpsAntBuild', assembleEditorToTextJar
}

task mpsClean {
    group 'mps'
    dependsOn 'mpsAntCleanSources'
}

task mpsTest {
    group 'mps'
    dependsOn 'mpsAntCheck', 'parseTestReportAfterAntCheck'
}

task openProjectInMps {
    group 'mps'
    dependsOn openProjectInMpsForCurrentOs
}

task buildAndOpenProjectInMps {
    group 'mps'
    dependsOn mpsBuild, openProjectInMps
}
